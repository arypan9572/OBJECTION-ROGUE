<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OBJECTION ROGUE</title>

<!-- 8-bit font -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#020403;
  --panel:#041b0f;
  --panel-dark:#02140a;
  --green:#00ff88;
  --green-dim:#00aa5a;
  --red:#ff4444;
  --yellow:#ffee55;
  --text:#b6ffd9;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  font-family:'Press Start 2P', monospace;
  overflow:hidden;
}
#crt{
  min-height:100vh;
  padding:22px;
  display:flex;
  justify-content:center;
  align-items:center;
}

#cutsceneText::after {
  content: "▮";
  animation: blink 1s infinite;
}

@keyframes blink {
  0%,50% { opacity:1; }
  51%,100% { opacity:0; }
}

/* CRT curvature + blur */
#screen{
  width:100%;
  max-width:980px;
  background:radial-gradient(circle at center, #044 0%, var(--bg) 70%);
  color:var(--text);
  border-radius:18px;
  padding:22px;
  transform-style: preserve-3d;
  will-change: transform, filter;
  box-shadow:
    0 0 60px rgba(0,255,136,0.25),
    inset 0 0 80px rgba(0,0,0,0.8);
  filter:blur(0.4px) contrast(1.15) saturate(1.2);
}
/* vignette */
#screen::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:18px;
  box-shadow:inset 0 0 120px rgba(0,0,0,0.85);
  pointer-events:none;
}
/* scanlines */
#screen::after{
  content:"";
  position:absolute;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(0,0,0,0.25),
    rgba(0,0,0,0.25) 1px,
    rgba(0,0,0,0) 3px,
    rgba(0,0,0,0) 5px
  );
  pointer-events:none;
}
#screen::after {
  animation: scanWarp 3s linear infinite;
}

@keyframes scanWarp {
  0% { background-position-y: 0; }
  100% { background-position-y: 6px; }
}


/* CRT MAGIC CARPET BEND */
#screen::marker { display:none; }

#screen::before,
#screen::after {
  transform-origin: center;
}

#screen {
  position: relative;
}

/* horizontal curve */
#screen::after {
  transform: scaleX(1.03) scaleY(0.98);
}

/* vertical curve */
#screen::before {
  transform: scaleY(1.03) scaleX(0.98);
}

#game{position:relative}
header{
  border:4px solid var(--green);
  padding:14px;
  margin-bottom:14px;
  background:linear-gradient(180deg, var(--panel) 0%, var(--panel-dark) 100%);
}
header h1{margin:0 0 10px 0;font-size:18px;color:var(--green)}
#stats{font-size:10px;line-height:1.6}
.panel{
  border:4px solid var(--green);
  background:linear-gradient(180deg, var(--panel) 0%, var(--panel-dark) 100%);
  padding:14px;
  margin-bottom:14px;
}
#court{min-height:200px;font-size:11px;line-height:1.8}
.label{color:var(--yellow)}
.courtroom{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-bottom:10px;
}
.sprite{
  border:3px solid var(--green-dim);
  padding:6px;
  font-size:8px;
  text-align:center;
}
.buttons{display:flex;flex-wrap:wrap;gap:10px}
.btn{
  font-family:'Press Start 2P', monospace;
  font-size:9px;
  padding:12px 14px;
  background:var(--panel-dark);
  color:var(--green);
  border:4px solid var(--green);
  cursor:pointer;
  box-shadow:inset -4px -4px 0 rgba(0,0,0,0.6);
}
.btn:hover{background:#063b22}
.btn:active{transform:translate(2px,2px);box-shadow:none}
.btn.objection{background:var(--green);color:#000}
.log{font-size:9px;max-height:240px;overflow:auto}
.log div{margin-bottom:6px}
.good{color:var(--green)}
.bad{color:var(--red)}
.info{color:var(--yellow)}
footer{text-align:center;font-size:8px;opacity:0.7}

/* ===============================
   EXTREME MAGIC CARPET CRT
================================ */

#screen-wrap {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;

  perspective: 1400px;
  overflow: hidden;
}


#screen {
  position: relative;
  transform-style: preserve-3d;
  filter: contrast(1.2) saturate(1.3);
}

/* STRONG BARREL CURVE */
#screen::before {
  content:"";
  position:absolute;
  inset:-6%;
  background: radial-gradient(
    ellipse at center,
    rgba(255,255,255,0.04) 0%,
    rgba(0,0,0,0.85) 70%
  );
  transform:
    scaleX(1.18)
    scaleY(1.12);
  pointer-events:none;
}

/* RGB EDGE SPLIT */
#screen::after {
  content:"";
  position:absolute;
  inset:0;
  background: transparent;
  box-shadow:
    -3px 0 rgba(255,0,0,0.15),
     3px 0 rgba(0,255,255,0.15);
  mix-blend-mode: screen;
  pointer-events:none;
}

/* SCREEN BREATH */
@keyframes crtBreath {
  0%   { transform: scale(1.01); }
  50%  { transform: scale(1.035); }
  100% { transform: scale(1.01); }
}

/* ===============================
   PIXEL JUDGE
================================ */

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

#judge-head{
  display:inline-block;
  font-size:0;
  line-height:0;
  image-rendering: pixelated;
}

.row{
  display:flex;
}

.pixel{
  width:10px;  /* adjust pixel size */
  height:10px;
}


/* ===============================
   ANIMATIONS (reuse existing)
================================ */
@keyframes judgeIdle {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(1px); }
}

@keyframes judgeApprove {
  0% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
  100% { transform: translateY(0); }
}

@keyframes judgeAngry {
  0% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  50% { transform: translateX(2px); }
  75% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

.judge.idle{
  animation: judgeIdle 1.6s infinite steps(2);
}

.judge.good{
  animation: judgeApprove 0.4s steps(2);
}

.judge.bad{
  animation: judgeAngry 0.4s steps(2);
}

/* blinking cursor variations */
.blink1::after { content: "▮"; animation: blink1 1s infinite; }
.blink2::after { content: "_"; animation: blink2 0.8s infinite; }
.blink3::after { content: "|"; animation: blink3 0.6s infinite; }

@keyframes blink1 { 0%,50% { opacity:1 } 51%,100% { opacity:0 } }
@keyframes blink2 { 0%,40% { opacity:1 } 41%,100% { opacity:0 } }
@keyframes blink3 { 0%,60% { opacity:1 } 61%,100% { opacity:0 } }

/* wave text effect */
.wave span { display:inline-block; animation: wave 1.5s ease-in-out infinite; }
@keyframes wave {
  0%,100% { transform: translateY(0); }
  25% { transform: translateY(-3px); }
  50% { transform: translateY(3px); }
  75% { transform: translateY(-2px); }
}


</style>
</head>
<body>
<div id="crt"><div id="screen-wrap">   <div id="screen"><div id="game">
<header class="topbar">
  <div class="title">
    <h1>OBJECTION ROGUE</h1>
    <div id="stats"></div>
  </div>

<div id="judge" class="judge idle">
  <div id="judge-head">
    <!-- Row 1 -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.1)"></div>
    </div>
    <!-- Row 2: wig top -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.4)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.4)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.4)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
    </div>
    <!-- Row 3: wig sides -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.3)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.5)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.5)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.5)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.3)"></div>
    </div>
    <!-- Row 4: eyes -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,30,0,1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.5)"></div>
      <div class="pixel" style="background: rgba(0,30,0,1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
    </div>
    <!-- Row 5: nose -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,150,0,1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.5)"></div>
      <div class="pixel" style="background: rgba(0,150,0,1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
    </div>
    <!-- Row 6: mouth -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.1)"></div>
      <div class="pixel" style="background: rgba(0,80,0,1)"></div>
      <div class="pixel" style="background: rgba(0,150,0,1)"></div>
      <div class="pixel" style="background: rgba(0,80,0,1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.1)"></div>
    </div>
    <!-- Row 7-8: robe collar -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.1)"></div>
      <div class="pixel" style="background: rgba(0,200,0,0.8)"></div>
      <div class="pixel" style="background: rgba(0,200,0,0.8)"></div>
      <div class="pixel" style="background: rgba(0,200,0,0.8)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.1)"></div>
    </div>
    <div class="row">
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
      <div class="pixel" style="background: rgba(0,180,0,1)"></div>
      <div class="pixel" style="background: rgba(0,180,0,1)"></div>
      <div class="pixel" style="background: rgba(0,180,0,1)"></div>
      <div class="pixel" style="background: rgba(0,255,136,0.2)"></div>
    </div>
    <!-- Row 9: gavel -->
    <div class="row">
      <div class="pixel" style="background: rgba(0,100,0,1)"></div>
      <div class="pixel" style="background: rgba(0,150,0,1)"></div>
      <div class="pixel" style="background: rgba(0,150,0,1)"></div>
      <div class="pixel" style="background: rgba(0,150,0,1)"></div>
      <div class="pixel" style="background: rgba(0,100,0,1)"></div>
    </div>
  </div>
</div>


</header>

<div id="court" class="panel"></div>
<div class="panel"><div class="buttons" id="actions"></div></div>
<div class="panel log" id="log"></div>
<footer>8-BIT CRT COURTROOM // INSPIRED BY OBJECTION! (1992)</footer>
</div></div></div></div>


<footer>
  8-BIT LEGAL ROGUELITE // INSPIRED BY OBJECTION! (1992)
</footer>

</div>
</div>

<script>
/***********************************************************
 * OBJECTION ROGUE — FULL 8-BIT ROGUELITE CORE
 ***********************************************************/

// -------- OBJECTION TYPES --------
const OBJECTIONS = [
  {name:'Hearsay', desc:'Out-of-court statement'},
  {name:'Leading', desc:'Suggests answer'},
  {name:'Irrelevant', desc:'Not related to case'},
  {name:'Speculation', desc:'Guessing intent'},
  {name:'Foundation', desc:'Evidence not established'},
  {name:'Argumentative', desc:'Attorney arguing'},
  {name:'Compound', desc:'Multiple questions at once'}
];

// -------- WITNESS TRAITS --------
const WITNESS_TRAITS = [
  'Nervous','Confident','Hostile','Forgetful','Expert','Deceptive'
];

// Templates for generating lots of prompts
const WITNESS_TEMPLATES = [
  "says they saw the defendant %ACTION%",
  "claims they were %ADJ% when they witnessed the event",
  "mentions %EVENT% happened that night",
  "guesses the defendant was %EMOTION%",
  "talks about %EVENT% that may or may not be related"
];

const LAWYER_TEMPLATES = [
  "Did you see the defendant %ACTION%?",
  "Isn't it true that you were %ADJ% that evening?",
  "Explain why you %VERB% the document",
  "How can you say you %VERB% without proof?",
  "Would you admit you %VERB% at the time?"
];

const ACTIONS = ["running away", "holding a knife", "yelling", "entering the room", "breaking the window"];
const ADJECTIVES = ["angry", "nervous", "intoxicated", "sleepy", "distracted"];
const EVENTS = ["a fight", "a theft", "an argument", "a car crash", "a mysterious noise"];
const EMOTIONS = ["scared", "happy", "confused", "angry"];
const WITNESS_MOODS = ["nervous","angry","sarcastic","calm","confused"];

const FILLERS = {
  nervous: ["Uh… probably ", "I mean… I think ", "Well… maybe ", "Um… yes, "],
  angry: ["Yes! ", "No! ", "Obviously ", "Of course "],
  sarcastic: ["Yeah… sure. ", "Right… totally ", "Obviously… "],
  calm: ["Yes. ", "No. ", "I believe ", "It seems "],
  confused: ["I… I think ", "Maybe ", "I guess ", "Possibly "]
};


const LAWYER_LABELS = [
  "LAWYER ASKS:",
  "LAWYER PRESSES:",
  "DEFENSE COUNSEL ASKS:",
  "DEFENSE PRESSES:"
];

const WITNESS_LABELS = [
  "WITNESS ANSWERS:",
  "WITNESS HESITATES:",
  "WITNESS SNAPS:",
  "WITNESS MUTTERS:"
];

const VERBS = ["signed", "ignored", "took", "destroyed", "altered"];

// ================================
// CASE GENERATOR (20 QUESTIONS)
// ================================

const CASE_TOPICS = [
  "a robbery at a convenience store at 11:42 PM",
  "a fight in a parking lot at midnight",
  "a hit-and-run accident at dusk",
  "a theft outside an apartment building",
  "a suspicious noise reported at 2:15 AM",
  "an argument inside a private residence",
  "a disturbance near a subway station",
  "a break-in at a closed restaurant",
  "a crime reported during a storm",
  "an incident outside a nightclub"
];


const QUESTION_TEMPLATES = [

/* === NO OBJECTION (NORMAL QUESTIONS) === */
{q:"What did you personally observe?",a:"I saw the defendant %ACTION%.",type:null},
{q:"Where were you located when this occurred?",a:"Near the %LOCATION%.",type:null},
{q:"What occurred immediately after that?",a:"The defendant %ACTION%.",type:null},
{q:"Did anything unusual catch your attention?",a:"There was shouting.",type:null},
{q:"Approximately how long did this continue?",a:"A few minutes.",type:null},
{q:"Did you recognize any of the individuals involved?",a:"Yes, the defendant.",type:null},
{q:"How did you feel in that moment?",a:"I felt %EMOTION%.",type:null},
{q:"Can you describe what you saw in your own words?",a:"I saw the defendant %ACTION%.",type:null},
{q:"What time did this take place?",a:"Late at night.",type:null},
{q:"What was the environment like?",a:"It was tense.",type:null},

/* === LEADING (SUBTLE) === */
{q:"You noticed the defendant acting unusual, correct?",a:"Yes.",type:"Leading"},
{q:"It seemed chaotic to you, didn’t it?",a:"Yes.",type:"Leading"},
{q:"You would agree the situation was tense?",a:"I suppose so.",type:"Leading"},
{q:"You saw the defendant leave immediately afterward, correct?",a:"Yes.",type:"Leading"},
{q:"You felt unsafe there, didn’t you?",a:"No.",type:"Leading"},
{q:"So the defendant was the only one behaving strangely?",a:"Yes.",type:"Leading"},
{q:"That behavior appeared suspicious to you, correct?",a:"Yes.",type:"Leading"},
{q:"You had no doubt it was the defendant?",a:"Yes.",type:"Leading"},
{q:"The defendant stood out from everyone else, didn’t they?",a:"Yes.",type:"Leading"},

/* === SPECULATION (SUBTLE & HARDER) === */
{q:"Why do you think the defendant left?",a:"Probably fear.",type:"Speculation"},
{q:"What do you believe caused this behavior?",a:"Panic.",type:"Speculation"},
{q:"What were they feeling at that moment?",a:"%EMOTION%.",type:"Speculation"},
{q:"What do you assume happened before you arrived?",a:"I’m not sure.",type:"Speculation"},
{q:"What motive do you think the defendant had?",a:"I don’t know.",type:"Speculation"},
{q:"Why would someone act that way?",a:"Because they were scared.",type:"Speculation"},
{q:"Do you think the defendant intended to scare anyone?",a:"Possibly.",type:"Speculation"},
{q:"What do you suppose their goal was?",a:"I guess escape.",type:"Speculation"},

/* === HEARSAY === */
{q:"How did you learn about this?",a:"Someone told me later.",type:"Hearsay"},
{q:"Is that based on what others said?",a:"Yes.",type:"Hearsay"},
{q:"Did you witness that yourself?",a:"No.",type:"Hearsay"},
{q:"Who informed you of that?",a:"A friend.",type:"Hearsay"},
{q:"What were you told afterward?",a:"That the defendant ran.",type:"Hearsay"},
{q:"Did someone else describe this to you?",a:"Yes.",type:"Hearsay"},
{q:"Is your knowledge based on conversations with others?",a:"Yes.",type:"Hearsay"},

/* === COMPOUND (NOT OBVIOUS) === */
{q:"Did you see the defendant and hear shouting?",a:"Yes.",type:"Compound"},
{q:"Were you frightened and confused at the same time?",a:"Yes.",type:"Compound"},
{q:"Did you notice the defendant and the victim arguing?",a:"Yes.",type:"Compound"},
{q:"Did you run and call for help?",a:"Yes.",type:"Compound"},
{q:"Did you observe the defendant and then contact the police?",a:"Yes.",type:"Compound"},
{q:"Were you watching the scene while trying to escape?",a:"Yes.",type:"Compound"},
{q:"Did the noise start and the defendant leave?",a:"Yes.",type:"Compound"},
{q:"Did you hear a sound and see someone running?",a:"Yes.",type:"Compound"},

/* === FOUNDATION === */
{q:"Where did that information come from?",a:"I don’t remember.",type:"Foundation"},
{q:"Who gave you that detail?",a:"Someone else.",type:"Foundation"},
{q:"How do you know this?",a:"I was told.",type:"Foundation"},
{q:"What source supports that claim?",a:"I’m not sure.",type:"Foundation"},
{q:"What evidence do you have for that?",a:"I don’t know.",type:"Foundation"},
{q:"Can you verify that information?",a:"No.",type:"Foundation"},
{q:"How was that established?",a:"I don’t recall.",type:"Foundation"},

/* === ARGUMENTATIVE === */
{q:"Do you expect the court to believe that?",a:"Yes.",type:"Argumentative"},
{q:"Is that really reliable?",a:"I think so.",type:"Argumentative"},
{q:"Are you certain you’re not mistaken?",a:"I’m sure.",type:"Argumentative"},
{q:"So we’re just supposed to trust you?",a:"Yes.",type:"Argumentative"},
{q:"Does that story even make sense to you?",a:"I guess.",type:"Argumentative"},
{q:"Isn’t that a convenient explanation?",a:"Maybe.",type:"Argumentative"},
{q:"You want us to accept that without proof?",a:"Yes.",type:"Argumentative"}

];




let currentCase = [];
let questionIndex = 0;
  
let currentCutscene = [];

function generateCutscene(topic){
  // variations for each line (except last)
  const intros = [
    `CASE FILE: ${topic.toUpperCase()}`,
    `FILE OPENED: ${topic.toUpperCase()}`,
    `RECORDS SHOW: ${topic.toUpperCase()}`,
    `INVESTIGATION NOTES: ${topic.toUpperCase()}`
  ];

  const alerts = [
    `Authorities received a report about ${topic}.`,
    `Dispatch logs show a call regarding ${topic}.`,
    `Someone nearby reported suspicious activity: ${topic}.`,
    `A witness mentioned unusual events involving ${topic}.`
  ];

  const witnessLines = [
    `One civilian claims to have noticed the defendant around the scene.`,
    `A bystander reports seeing someone near the area at the time.`,
    `A witness states they observed movement near the incident.`,
    `Someone says they were close by and saw the defendant.`
  ];

  const inconsistencies = [
    `However, the account is inconsistent and may be biased.`,
    `Yet, some details contradict known facts, raising doubts.`,
    `Inconsistencies suggest the witness may be mistaken.`,
    `Certain claims do not align with evidence and must be checked.`
  ];

  const prosecutionLines = [
    `The prosecution aims to prove guilt through questioning.`,
    `Legal representatives will attempt to establish responsibility.`,
    `Prosecutors will examine each statement carefully.`,
    `Expect the prosecution to press for confirmations.`
  ];

  const defenseLines = [
    `Your duty is to uncover flaws and contradictions.`,
    `As defense counsel, spot errors and expose assumptions.`,
    `It’s up to you to challenge unreliable testimony.`,
    `Be vigilant: not every statement is as it seems.`
  ];

  const listenLines = [
    `Listen closely. Mistakes can be subtle.`,
    `Pay attention — some errors are hidden.`,
    `Observe carefully; assumptions may mislead.`,
    `Every detail counts, so stay alert.`
  ];

  const objectionLines = [
    `Only precise objections reveal the truth.`,
    `A well-timed objection can change the outcome.`,
    `Objections are your tool to defend justice.`,
    `Strategic objections will uncover hidden lies.`
  ];

  // last line is always fixed
  const finalLine = `COURT IS NOW IN SESSION.`;

  // pick random one from each array
  return [
    rand(intros),
    rand(alerts),
    rand(witnessLines),
    rand(inconsistencies),
    rand(prosecutionLines),
    rand(defenseLines),
    rand(listenLines),
    rand(objectionLines),
    finalLine
  ];
}





function generateCase() {
  currentCase = [];
  questionIndex = 0;

  const topic = rand(CASE_TOPICS);
  currentCutscene = generateCutscene(topic);

  for(let i=0;i<20;i++){
    const t = rand(QUESTION_TEMPLATES);

    const action = rand(ACTIONS);
    const event = topic;
    const emotion = rand(EMOTIONS);
    const adj = rand(ADJECTIVES);

    const q = t.q
      .replace("%ACTION%", action)
      .replace("%EVENT%", event)
      .replace("%EMOTION%", emotion)
      .replace("%ADJ%", adj);

const filler = rand(FILLERS);
const mood = rand(WITNESS_MOODS);


const a = filler + t.a
  .replace("%ACTION%", action)
  .replace("%EVENT%", event)
  .replace("%EMOTION%", emotion)
  .replace("%ADJ%", adj);

currentCase.push({
  question: q,
  answer: a,
  objection: t.type,
  mood: mood
});

  }
}





// -------- GAME STATE --------
let run = 1;
let caseNum = 1;
let phase = 'CROSS';
let objections = 5;
let credibility = 100;
let streak = 0;
let witness = {};
let current = {};

let cutsceneStage = "DEFENSE"; // DEFENSE or WITNESS
let earlyObjection = false;

let gameMode = "START"; // START, CUTSCENE, GAME
let cutsceneIndex = 0;


// -------- DOM --------
const court = document.getElementById('court');
const actions = document.getElementById('actions');
const log = document.getElementById('log');
const stats = document.getElementById('stats');

// -------- UTIL --------
function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function getCorrectObjection(type, text) {
  const lower = text.toLowerCase();

  // 20% chance the statement is fine — no objection
  if(Math.random() < 0.2) return null; // <-- this makes No Objection correct

  if(type === "WITNESS") {
    if(lower.includes("heard") || lower.includes("saw")) return "Hearsay";
    if(lower.includes("guess") || lower.includes("thinks")) return "Speculation";
    if(lower.includes("may or may not") || lower.includes("unrelated")) return "Irrelevant";
    return "Hearsay"; // fallback
  } else { // LAWYER
    if(lower.startsWith("did you") || lower.startsWith("isn't it")) return "Leading";
    if(lower.includes("and")) return "Compound";
    if(lower.includes("why") || lower.includes("how")) return "Argumentative";
    return "Foundation"; // fallback
  }
}



// -------- CORE LOOP --------

function formatText(text) {
  // If text starts with quotes or is clearly a quote, keep it
  if(text.startsWith('"') || text.startsWith('“') || text.includes('says') || text.includes('states')) {
    return text;
  }
  // Otherwise, wrap in quotes
  return `“${text}”`;
}
  
function getSpeakerLabel(type, text) {
  if(type === 'WITNESS') {
    // If text has normal sentence, say SAYS, else CLAIMS
    const lower = text.toLowerCase();
    if(lower.includes('i ') || lower.includes('you ') || lower.endsWith('.') || lower.endsWith('!') || lower.endsWith('?')) {
      return 'SAYS';
    } else {
      return 'CLAIMS';
    }
  } else {
    return 'ASKS'; // for lawyer questions
  }
}

// =============================
// SANS-TYPE TEXT ANIMATION
// =============================
let typingInterval;

function typeText(element, text, speed = 25, callback = null){
  let i = 0;
  element.textContent = "";
  clearInterval(typingInterval);

  typingInterval = setInterval(() => {
    if(i < text.length){
      element.textContent += text[i];
      i++;
    } else {
      clearInterval(typingInterval);
      if(callback) callback(); // optional callback when done
    }
  }, speed);
}


function showStartScreen(){
  gameMode = "START";

  court.innerHTML = `
    <div style="text-align:center">
      <h1 style="color:var(--green)">OBJECTION ROGUE</h1>
      <p>8-BIT CRT COURTROOM SIMULATION</p>
      <br>
      <p>PRESS START</p>
      <br><br>
      <button class="btn objection" onclick="startGame()">START</button>
    </div>
  `;

  actions.innerHTML = "";
  log.innerHTML = "";
  stats.innerHTML = "";
}

function startGame(){
  cutsceneIndex = 0;
  generateCase();   // generate ONCE
  showCutscene();
}


function showCutscene(){
  gameMode = "CUTSCENE";

  court.innerHTML = `
    <div class="label">CASE FILE</div><br><br>
    <div id="cutsceneText"></div>
    <br><br>
    <button class="btn" onclick="nextCutscene()">NEXT</button>
  `;

  actions.innerHTML = "";

  const textBox = document.getElementById("cutsceneText");
  const text = currentCutscene[cutsceneIndex];

  // randomly pick effect
  const effect = rand(['blink1','blink2','blink3','wave','none']);

  if(effect === 'wave'){
    // wrap each letter in a span for wave
    textBox.innerHTML = '';
    text.split('').forEach(char=>{
      const span = document.createElement('span');
      span.textContent = char;
      textBox.appendChild(span);
    });
    textBox.classList.add('wave');
  } else if(effect.startsWith('blink')){
    textBox.classList.add(effect);
    typeText(textBox, text, 22);
  } else {
    typeText(textBox, text, 22);
  }
}




function nextCutscene(){

  // If NOT last line yet → keep showing cutscene
  if(cutsceneIndex < currentCutscene.length - 1){
    cutsceneIndex++;
    showCutscene();
  }
  // If LAST line ("COURT IS NOW IN SESSION.")
  else{
    gameMode = "GAME";
    questionIndex = 0;

    court.innerHTML = "";   // clear cutscene screen
    actions.innerHTML = ""; // clear NEXT button

    nextCase(); // enter the courtroom
  }
}


function showWitnessResponse() {
  cutsceneStage = "WITNESS";

  const mood = current.mood.toLowerCase();

  // mood-consistent labels
  const labelMap = {
    nervous: "NERVOUS WITNESS:",
    angry: "ANGRY WITNESS:",
    sarcastic: "SARCASTIC WITNESS:",
    calm: "WITNESS RESPONDS:",
    confused: "CONFUSED WITNESS:"
  };

  const witnessLabel = labelMap[mood] || "WITNESS RESPONDS:";

  // hesitant but clear yes/no
  const yesNo = Math.random() < 0.5 ? "yes." : "no.";
  const filler = rand(FILLERS[mood] || [""]);

  const answer = filler + yesNo;

  court.innerHTML += `
    <br><div class='label'>${witnessLabel}</div>
    <div id="witnessText"></div>
  `;

  typeSansText(`“${answer}”`, document.getElementById("witnessText"));

  createButtons(false);
}


  
function typeSansText(text, el) {
  el.innerHTML = "";
  let i = 0;

  const interval = setInterval(() => {
    el.innerHTML += text[i];
    i++;
    if (i >= text.length) clearInterval(interval);
  }, 35);
}


function nextCase() {
  witness = { trait: rand(WITNESS_TRAITS) };
current = currentCase[questionIndex];
questionIndex++; // move to next question next time

  cutsceneStage = "DEFENSE";
  earlyObjection = false;

  const lawyerLabel = rand([
    "OPPOSING COUNSEL ASKS:",
    "LAWYER PRESSES:",
    "PROSECUTOR STATES:",
    "ATTORNEY ARGUES:"
  ]);

  court.innerHTML = `
    <div class='courtroom'>
      <div class='sprite'>JUDGE</div>
      <div class='sprite'>JURY</div>
      <div class='sprite'>DEFENSE</div>
      <div class='sprite'>WITNESS</div>
    </div>

    <div class='label'>${lawyerLabel}</div>
    <div id="defenseText" class="sans"></div>

    <br><div class='info'>[Press SPACE to continue]</div>
  `;
// Descriptive courtroom lines
court.innerHTML += `
  <div class='label'>COURTROOM DESCRIPTION:</div>
  <div id='courtDesc' class='info'>
    The witness appears ${current.mood.toLowerCase()}.<br>
    The judge watches silently. The jury takes notes.<br>
    You sense tension in the room. Every word matters.
  </div>
`;

  actions.innerHTML = "";
  createButtons(true);

typeSansText(formatText(current.question), document.getElementById("defenseText"));
}


function createButtons(isEarly) {
  actions.innerHTML = "";
  earlyObjection = isEarly;

  OBJECTIONS.forEach(o=>{
    const b=document.createElement('button');
    b.className='btn objection';
    b.textContent=o.name.toUpperCase();
    b.onclick=()=>object(o.name);
    actions.appendChild(b);
  });

  const no=document.createElement('button');
  no.className='btn';
  no.textContent='NO OBJECTION';
  no.onclick=()=>object(null);
  actions.appendChild(no);
}


function object(type){
  let multiplier = earlyObjection ? 2 : 1;

  if(type) objections--;

if(type === current.objection){
    streak++;
    credibility += 5 * multiplier;
    logMsg(`CORRECT (${multiplier}x bonus!)`, 'good');
    logMsg(getExplanation(type, true), 'info'); // <-- ADD explanation
} else {
    credibility -= 10;
    streak = 0;
    logMsg(`WRONG. Correct was: ${current.objection}`, 'bad');
    logMsg(getExplanation(current.objection, false), 'info'); // <-- ADD explanation
}



  nextCase();
}




function getExplanation(objectionType, isCorrect) {
  const reasons = {
    'Hearsay': 'The witness is repeating something they heard from someone else instead of personal knowledge.',
    'Leading': 'The lawyer suggests the answer instead of letting the witness respond freely.',
    'Irrelevant': 'The testimony does not relate to the facts of the case.',
    'Speculation': 'The witness is guessing about thoughts or intentions.',
    'Foundation': 'Evidence was mentioned without proving where it came from.',
    'Argumentative': 'The lawyer is arguing instead of asking a neutral question.',
    'Compound': 'The question asks more than one thing at once.',
    null: 'No objection is needed because the statement is legally acceptable.'
  };

  if(isCorrect){
    return `✅ Reason: ${reasons[objectionType]}`;
  } else {
    return `❌ Reason: ${reasons[objectionType]}`;
  }
}



function endRun(){
  court.innerHTML = `
    <div class='label'>COURT ADJOURNED</div><br><br>
    FINAL STREAK: ${streak}<br>
    FINAL CREDIBILITY: ${credibility}
  `;
  actions.innerHTML='';
  logMsg('RUN OVER — RESETTING', 'bad');

setTimeout(()=>{
    run++;
    caseNum=1;
    phase='CROSS';
    objections=5;
    credibility=100;
    streak=0;
    log.innerHTML='';
    cutsceneIndex = 0;
  caseNum++;
  generateCase();
    showCutscene();
  },3000);
}

function updateStats(){
  stats.innerHTML = `RUN ${run} | CASE ${caseNum}<br>OBJECTIONS ${objections} | CRED ${credibility} | STREAK ${streak}`;
}

function logMsg(m,c){
  const d=document.createElement('div');
  d.className=c;
  d.textContent='> '+m;
  log.prepend(d);
}

// -------- SMOOTH MOUSE PARALLAX (HEAVY EASING) --------
const screenEl = document.getElementById('screen');

// MUCH subtler tilt
const maxTilt = 4; // was higher before

let targetRotX = 0,
    targetRotY = 0,
    currentRotX = 0,
    currentRotY = 0;

let targetZ = 0;
let currentZ = 0;


// Heavy easing = very slow settling
const easeFactor = 0.05; // lower = smoother & slower

window.addEventListener('mousemove', (e) => {
  const w = window.innerWidth;
  const h = window.innerHeight;

  const x = (e.clientX / w) * 2 - 1; // -1 left, +1 right
  const y = (e.clientY / h) * 2 - 1; // -1 top, +1 bottom

  // rotation
  targetRotY = x * maxTilt;
  targetRotX = -y * maxTilt;

  // DEPTH PARALLAX (this is what you want)
  // mouse corner pushes that corner BACK
  targetZ = -(Math.abs(x) + Math.abs(y)) * 40;
});


let time = 0;

function animateParallax() {
  time += 0.015;

  // Ease everything
  currentRotX += (targetRotX - currentRotX) * 0.07;
  currentRotY += (targetRotY - currentRotY) * 0.07;
  currentZ += (targetZ - currentZ) * 0.05;

  // CRT wave warp
  const waveX = Math.sin(time) * 3;
  const waveY = Math.cos(time * 0.8) * 3;
  const bendZ = Math.sin(time * 0.6) * 1.2;
  const breath = 1 + Math.sin(time * 0.5) * 0.03;

  screenEl.style.transform = `
    translateZ(${currentZ}px)
    rotateX(${currentRotX + waveY}deg)
    rotateY(${currentRotY + waveX}deg)
    rotateZ(${bendZ}deg)
    scale(${breath * 1.07}, ${breath * 0.93})
  `;

  requestAnimationFrame(animateParallax);
}

/********************
   ENHANCEMENTS
********************/

// ---------- 1. Keyboard Shortcuts for Objections ----------
window.addEventListener('keydown', (e) => {
  if(gameMode !== "GAME") return;

  const key = e.key;
  if(key >= '1' && key <= '7'){
    const index = parseInt(key)-1;
    if(OBJECTIONS[index]) object(OBJECTIONS[index].name);
  } else if(key === '0'){
    object(null); // No Objection
  }
});

// ---------- 2. Smooth Scrolling Log ----------
function logMsg(m,c){
  const d=document.createElement('div');
  d.className=c;
  d.textContent='> '+m;

  log.prepend(d);
  // Animate scroll to top smoothly
  log.scrollTo({ top: 0, behavior: 'smooth' });
}

// ---------- 3. Wave Text Fix for Spaces ----------
function showCutscene(){
  gameMode = "CUTSCENE";

  court.innerHTML = `
    <div class="label">CASE FILE</div><br><br>
    <div id="cutsceneText"></div>
    <br><br>
    <button class="btn" onclick="nextCutscene()">NEXT</button>
  `;

  actions.innerHTML = "";

  const textBox = document.getElementById("cutsceneText");
  const text = currentCutscene[cutsceneIndex];

  const effect = rand(['blink1','blink2','blink3','wave','none']);

  if(effect === 'wave'){
    textBox.innerHTML = '';
    text.split('').forEach(char=>{
      const span = document.createElement('span');
      // Preserve spaces visually
      span.textContent = char === ' ' ? '\u00A0' : char;
      textBox.appendChild(span);
    });
    textBox.classList.add('wave');
  } else if(effect.startsWith('blink')){
    textBox.classList.add(effect);
    typeText(textBox, text, 22);
  } else {
    typeText(textBox, text, 22);
  }
}

// ---------- 4. Responsive CRT Curvature ----------
function adjustCRTCurve(){
  const screenWrap = document.getElementById('screen-wrap');
  if(window.innerWidth < 600){
    // reduce curvature for small screens
    screenEl.style.transform = 'scale(0.95)';
  } else {
    screenEl.style.transform = 'scale(1)';
  }
}
window.addEventListener('resize', adjustCRTCurve);
adjustCRTCurve();

window.addEventListener("keydown", e => {
  if (e.code === "Space" && cutsceneStage === "DEFENSE") {
    showWitnessResponse();
  }
});

// -------- START --------
showStartScreen();
animateParallax();

</script>
</body>
</html>
