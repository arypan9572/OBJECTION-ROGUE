<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OBJECTION ROGUE</title>

<!-- 8-bit font -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#020403;
  --panel:#041b0f;
  --panel-dark:#02140a;
  --green:#00ff88;
  --green-dim:#00aa5a;
  --red:#ff4444;
  --yellow:#ffee55;
  --text:#b6ffd9;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  font-family:'Press Start 2P', monospace;
  overflow:hidden;
}
#crt{
  min-height:100vh;
  padding:22px;
  display:flex;
  justify-content:center;
  align-items:center;
}
/* CRT curvature + blur */
#screen{
  width:100%;
  max-width:980px;
  background:radial-gradient(circle at center, #044 0%, var(--bg) 70%);
  color:var(--text);
  border-radius:18px;
  padding:22px;
  transform-style: preserve-3d;
  will-change: transform, filter;
  box-shadow:
    0 0 60px rgba(0,255,136,0.25),
    inset 0 0 80px rgba(0,0,0,0.8);
  filter:blur(0.4px) contrast(1.15) saturate(1.2);
}
/* vignette */
#screen::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:18px;
  box-shadow:inset 0 0 120px rgba(0,0,0,0.85);
  pointer-events:none;
}
/* scanlines */
#screen::after{
  content:"";
  position:absolute;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(0,0,0,0.25),
    rgba(0,0,0,0.25) 1px,
    rgba(0,0,0,0) 3px,
    rgba(0,0,0,0) 5px
  );
  pointer-events:none;
}
#screen::after {
  animation: scanWarp 3s linear infinite;
}

@keyframes scanWarp {
  0% { background-position-y: 0; }
  100% { background-position-y: 6px; }
}


/* CRT MAGIC CARPET BEND */
#screen::marker { display:none; }

#screen::before,
#screen::after {
  transform-origin: center;
}

#screen {
  position: relative;
}

/* horizontal curve */
#screen::after {
  transform: scaleX(1.03) scaleY(0.98);
}

/* vertical curve */
#screen::before {
  transform: scaleY(1.03) scaleX(0.98);
}

#game{position:relative}
header{
  border:4px solid var(--green);
  padding:14px;
  margin-bottom:14px;
  background:linear-gradient(180deg, var(--panel) 0%, var(--panel-dark) 100%);
}
header h1{margin:0 0 10px 0;font-size:18px;color:var(--green)}
#stats{font-size:10px;line-height:1.6}
.panel{
  border:4px solid var(--green);
  background:linear-gradient(180deg, var(--panel) 0%, var(--panel-dark) 100%);
  padding:14px;
  margin-bottom:14px;
}
#court{min-height:200px;font-size:11px;line-height:1.8}
.label{color:var(--yellow)}
.courtroom{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-bottom:10px;
}
.sprite{
  border:3px solid var(--green-dim);
  padding:6px;
  font-size:8px;
  text-align:center;
}
.buttons{display:flex;flex-wrap:wrap;gap:10px}
.btn{
  font-family:'Press Start 2P', monospace;
  font-size:9px;
  padding:12px 14px;
  background:var(--panel-dark);
  color:var(--green);
  border:4px solid var(--green);
  cursor:pointer;
  box-shadow:inset -4px -4px 0 rgba(0,0,0,0.6);
}
.btn:hover{background:#063b22}
.btn:active{transform:translate(2px,2px);box-shadow:none}
.btn.objection{background:var(--green);color:#000}
.log{font-size:9px;max-height:240px;overflow:auto}
.log div{margin-bottom:6px}
.good{color:var(--green)}
.bad{color:var(--red)}
.info{color:var(--yellow)}
footer{text-align:center;font-size:8px;opacity:0.7}

/* ===============================
   EXTREME MAGIC CARPET CRT
================================ */

#screen-wrap {
  perspective: 1400px;
}

#screen {
  position: relative;
  transform-style: preserve-3d;
  animation: crtBreath 6s ease-in-out infinite;
  filter: contrast(1.2) saturate(1.3);
}

/* STRONG BARREL CURVE */
#screen::before {
  content:"";
  position:absolute;
  inset:-6%;
  background: radial-gradient(
    ellipse at center,
    rgba(255,255,255,0.04) 0%,
    rgba(0,0,0,0.85) 70%
  );
  transform:
    scaleX(1.18)
    scaleY(1.12);
  pointer-events:none;
}

/* RGB EDGE SPLIT */
#screen::after {
  content:"";
  position:absolute;
  inset:0;
  background: transparent;
  box-shadow:
    -3px 0 rgba(255,0,0,0.15),
     3px 0 rgba(0,255,255,0.15);
  mix-blend-mode: screen;
  pointer-events:none;
}

/* SCREEN BREATH */
@keyframes crtBreath {
  0%   { transform: scale(1.01); }
  50%  { transform: scale(1.035); }
  100% { transform: scale(1.01); }
}

</style>
</head>
<body>
<div id="crt"><div id="screen-wrap">   <div id="screen"><div id="game">
<header>
  <h1>OBJECTION ROGUE</h1>
  <div id="stats"></div>
</header>
<div id="court" class="panel"></div>
<div class="panel"><div class="buttons" id="actions"></div></div>
<div class="panel log" id="log"></div>
<footer>8-BIT CRT COURTROOM // INSPIRED BY OBJECTION! (1992)</footer>
</div></div></div></div>


<footer>
  8-BIT LEGAL ROGUELITE // INSPIRED BY OBJECTION! (1992)
</footer>

</div>
</div>

<script>
/***********************************************************
 * OBJECTION ROGUE — FULL 8-BIT ROGUELITE CORE
 ***********************************************************/

// -------- OBJECTION TYPES --------
const OBJECTIONS = [
  {name:'Hearsay', desc:'Out-of-court statement'},
  {name:'Leading', desc:'Suggests answer'},
  {name:'Irrelevant', desc:'Not related to case'},
  {name:'Speculation', desc:'Guessing intent'},
  {name:'Foundation', desc:'Evidence not established'},
  {name:'Argumentative', desc:'Attorney arguing'},
  {name:'Compound', desc:'Multiple questions at once'}
];

// -------- WITNESS TRAITS --------
const WITNESS_TRAITS = [
  'Nervous','Confident','Hostile','Forgetful','Expert','Deceptive'
];

// Templates for generating lots of prompts
const WITNESS_TEMPLATES = [
  "says they saw the defendant %ACTION%",
  "claims they were %ADJ% when they witnessed the event",
  "mentions %EVENT% happened that night",
  "guesses the defendant was %EMOTION%",
  "talks about %EVENT% that may or may not be related"
];

const LAWYER_TEMPLATES = [
  "Did you see the defendant %ACTION%?",
  "Isn't it true that you were %ADJ% that evening?",
  "Explain why you %VERB% the document",
  "How can you say you %VERB% without proof?",
  "Would you admit you %VERB% at the time?"
];

const ACTIONS = ["running away", "holding a knife", "yelling", "entering the room", "breaking the window"];
const ADJECTIVES = ["angry", "nervous", "intoxicated", "sleepy", "distracted"];
const EVENTS = ["a fight", "a theft", "an argument", "a car crash", "a mysterious noise"];
const EMOTIONS = ["scared", "happy", "confused", "angry"];
const VERBS = ["signed", "ignored", "took", "destroyed", "altered"];

const PROMPTS = [];
  
// -------- Generate 500+ witness prompts --------
for(let i=0; i<500; i++){
  const template = rand(WITNESS_TEMPLATES);
  const text = template
    .replace("%ACTION%", rand(ACTIONS))
    .replace("%ADJ%", rand(ADJECTIVES))
    .replace("%EVENT%", rand(EVENTS))
    .replace("%EMOTION%", rand(EMOTIONS));

  const objection = getCorrectObjection("WITNESS", text); // use logic
  PROMPTS.push({type:"WITNESS", text, c:objection});
}

// -------- Generate 500+ lawyer prompts --------
for(let i=0; i<500; i++){
  const template = rand(LAWYER_TEMPLATES);
  const text = template
    .replace("%ACTION%", rand(ACTIONS))
    .replace("%ADJ%", rand(ADJECTIVES))
    .replace("%VERB%", rand(VERBS));

  const objection = getCorrectObjection("LAWYER", text); // use logic
  PROMPTS.push({type:"LAWYER", text, c:objection});
}



// -------- GAME STATE --------
let run = 1;
let caseNum = 1;
let phase = 'CROSS';
let objections = 5;
let credibility = 100;
let streak = 0;
let witness = {};
let current = {};

// -------- DOM --------
const court = document.getElementById('court');
const actions = document.getElementById('actions');
const log = document.getElementById('log');
const stats = document.getElementById('stats');

// -------- UTIL --------
function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function getCorrectObjection(type, text) {
  const lower = text.toLowerCase();

  // 20% chance the statement is fine — no objection
  if(Math.random() < 0.2) return null; // <-- this makes No Objection correct

  if(type === "WITNESS") {
    if(lower.includes("heard") || lower.includes("saw")) return "Hearsay";
    if(lower.includes("guess") || lower.includes("thinks")) return "Speculation";
    if(lower.includes("may or may not") || lower.includes("unrelated")) return "Irrelevant";
    return "Hearsay"; // fallback
  } else { // LAWYER
    if(lower.startsWith("did you") || lower.startsWith("isn't it")) return "Leading";
    if(lower.includes("and")) return "Compound";
    if(lower.includes("why") || lower.includes("how")) return "Argumentative";
    return "Foundation"; // fallback
  }
}



// -------- CORE LOOP --------

function formatText(text) {
  // If text starts with quotes or is clearly a quote, keep it
  if(text.startsWith('"') || text.startsWith('“') || text.includes('says') || text.includes('states')) {
    return text;
  }
  // Otherwise, wrap in quotes
  return `“${text}”`;
}
  
function getSpeakerLabel(type, text) {
  if(type === 'WITNESS') {
    // If text has normal sentence, say SAYS, else CLAIMS
    const lower = text.toLowerCase();
    if(lower.includes('i ') || lower.includes('you ') || lower.endsWith('.') || lower.endsWith('!') || lower.endsWith('?')) {
      return 'SAYS';
    } else {
      return 'CLAIMS';
    }
  } else {
    return 'ASKS'; // for lawyer questions
  }
}

function nextCase() {
  witness = { trait: rand(WITNESS_TRAITS) };
  current = rand(PROMPTS);
  const speaker = current.type==='WITNESS' ? 'WITNESS' : 'OPPOSING COUNSEL';
  const speakerLabel = getSpeakerLabel(current.type, current.text); // compute BEFORE template
  const formattedText = formatText(current.text); // compute BEFORE template

  court.innerHTML = `
    <div class='courtroom'>
      <div class='sprite'>JUDGE</div>
      <div class='sprite'>JURY</div>
      <div class='sprite'>${speaker}</div>
      <div class='sprite'>YOU</div>
    </div>
    <div class='label'>PHASE:</div> ${phase}<br>
    <div class='label'>WITNESS TRAIT:</div> ${witness.trait}<br><br>
    <div class='label'>${speakerLabel}:</div><br>
    ${formattedText}
  `;

  actions.innerHTML='';
  OBJECTIONS.forEach(o=>{
    const b=document.createElement('button');
    b.className='btn objection';
    b.textContent=o.name.toUpperCase();
    b.onclick=()=>object(o.name);
    actions.appendChild(b);
  });

  const no=document.createElement('button');
  no.className='btn';
  no.textContent='NO OBJECTION';
  no.onclick=()=>object(null);
  actions.appendChild(no);

  updateStats();
}

function object(type){
  if(type) objections--;

  let explanation = '';

  if(type === current.c){ // player picked the correct objection
    streak++;
    credibility += 5;
    explanation = getExplanation(current.c, true, current.text);
    logMsg(`CORRECT OBJECTION: ${type}\n${explanation}`, 'good');

  } else if(type === null){ // player clicked No Objection
    if(current.c === null){ // actually no objection needed
      streak++;
      credibility += 5;
      logMsg(`CORRECT: No Objection needed! ✅`, 'good');
    } else { // they missed a real objection
      credibility -= 10;
      streak = 0;
      explanation = getExplanation(current.c, false, current.text); // <-- use current.c here
      logMsg(`MISSED OBJECTION. SHOULD HAVE BEEN ${current.c}\n${explanation}`, 'bad');
    }

  } else { // wrong objection
    credibility -= 15;
    streak = 0;
    explanation = getExplanation(current.c, false, current.text); // <-- use current.c, not the one they clicked
    logMsg(`WRONG OBJECTION (${type})\nCorrect was: ${current.c}\n${explanation}`, 'bad');
  }

  if(credibility <= 0 || objections <= 0){
    endRun();
    return;
  }

  caseNum++;

  if(caseNum % 6 === 0){
    objections++;
    logMsg('BONUS: +1 OBJECTION', 'info');
  }

  if(caseNum % 10 === 0){
    phase = phase==='CROSS' ? 'REDIRECT' : 'CROSS';
    logMsg(`PHASE SHIFT: ${phase}`, 'info');
  }

  nextCase();
}


function getExplanation(objectionType, isCorrect, text) {
  const reasons = {
    'Hearsay': 'The witness is reporting something they heard from someone else, which is not allowed as evidence unless an exception applies.',
    'Leading': 'The question suggests the answer instead of letting the witness answer freely.',
    'Irrelevant': 'The testimony does not relate to the case at hand.',
    'Speculation': 'The witness is guessing about someone’s thoughts or intent, which is not admissible.',
    'Foundation': 'Evidence is being introduced without establishing its authenticity or relevance first.',
    'Argumentative': 'The lawyer is arguing or challenging the witness instead of asking a proper question.',
    'Compound': 'The question asks multiple things at once, making it confusing or unfair.',
    null: 'No objection is needed because the statement is acceptable and admissible as evidence.'
  };

  if (isCorrect) {
    return objectionType === null 
      ? '✅ This is correct! No objection needed.' 
      : `✅ This objection is correct because: ${reasons[objectionType]}`;
  } else {
    return objectionType === null 
      ? '❌ This statement was fine; no objection was needed.' 
      : `❌ This objection is incorrect. Correct reason: ${reasons[objectionType]}`;
  }
}


function endRun(){
  court.innerHTML = `
    <div class='label'>COURT ADJOURNED</div><br><br>
    FINAL STREAK: ${streak}<br>
    FINAL CREDIBILITY: ${credibility}
  `;
  actions.innerHTML='';
  logMsg('RUN OVER — RESETTING', 'bad');

  setTimeout(()=>{
    run++;
    caseNum=1;
    phase='CROSS';
    objections=5;
    credibility=100;
    streak=0;
    log.innerHTML='';
    nextCase();
  },3000);
}

function updateStats(){
  stats.innerHTML = `RUN ${run} | CASE ${caseNum}<br>OBJECTIONS ${objections} | CRED ${credibility} | STREAK ${streak}`;
}

function logMsg(m,c){
  const d=document.createElement('div');
  d.className=c;
  d.textContent='> '+m;
  log.prepend(d);
}

// -------- SMOOTH MOUSE PARALLAX (HEAVY EASING) --------
const screenEl = document.getElementById('screen');

// MUCH subtler tilt
const maxTilt = 4; // was higher before

let targetRotX = 0,
    targetRotY = 0,
    currentRotX = 0,
    currentRotY = 0;

// Heavy easing = very slow settling
const easeFactor = 0.05; // lower = smoother & slower

window.addEventListener('mousemove', (e) => {
  const w = window.innerWidth;
  const h = window.innerHeight;

  const xNorm = (e.clientX / w) * 2 - 1;
  const yNorm = (e.clientY / h) * 2 - 1;

  targetRotY = xNorm * maxTilt;
  targetRotX = -yNorm * maxTilt;
});

let time = 0;

function animateParallax() {
  time += 0.015;

  // Smooth mouse easing
  currentRotX += (targetRotX - currentRotX) * 0.06;
  currentRotY += (targetRotY - currentRotY) * 0.06;

  // CRT magic carpet waves
  const waveX = Math.sin(time) * 3.5;
  const waveY = Math.cos(time * 0.7) * 3.5;

  const bendZ = Math.sin(time * 0.5) * 1.2;

  // FINAL combined transform
  screenEl.style.transform = `
    perspective(1400px)
    rotateX(${currentRotX + waveY}deg)
    rotateY(${currentRotY + waveX}deg)
    rotateZ(${bendZ}deg)
    scaleX(1.08)
    scaleY(0.94)
  `;

  requestAnimationFrame(animateParallax);
}



// -------- START --------
nextCase();
</script>
</body>
</html>
